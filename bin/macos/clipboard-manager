#!/usr/bin/env bash

~/bin/focus-wezterm-picker $1

copyq_command=/Applications/CopyQ.app/Contents/MacOS/copyq

list_cmd="cat ~/projects/dotfiles/bin/macos/copyq-script.js | $copyq_command eval - | jq --raw-output '.[] | \"\(.row)\u001FîªŸ  \u001F\(.text)\u001F\(.type)\"'"

bind_arg="ctrl-x:execute-silent($copyq_command remove {1})+reload($list_cmd)"

generate_clipboard=$(bash -c "$list_cmd")

selected=$(
  printf '%s' "$generate_clipboard" \
    | fzf --delimiter=$'\x1f' --with-nth='2..3' --accept-nth=1 --preview="~/bin/clipboard-preview {1} {3} {4}" --bind "$bind_arg"
)

if [ ! -z "${selected}" ]; then
  #selected_index=(${selected//:/ })
  #$(eval "$copyq_command select ${selected_index[0]}")
  $(eval "$copyq_command select ${selected}")
fi

rm -f /tmp/copyq-image-*
