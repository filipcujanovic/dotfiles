#!/usr/bin/env bash

dim=${FZF_PREVIEW_COLUMNS}x${FZF_PREVIEW_LINES}

is_image=false
if [[ $3 == "image" ]]; then
  is_image=true
fi

if [[ $is_image = true ]]; then
  if [[ $KITTY_WINDOW_ID ]] || [[ $GHOSTTY_RESOURCES_DIR ]] && command -v kitten > /dev/null; then
    kitten icat --clear --transfer-mode=memory --unicode-placeholder --stdin=no --place="$dim@0x0" "$2" | sed '$d' | sed $'$s/$/\e[m/'
  else
    chafa -s "$dim" "$2"
    echo
  fi
else
  echo -e $2 | bat -n --color=always --style=numbers
fi
